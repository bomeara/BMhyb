<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PCM for Hybridization • BMhyb</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="PCM for Hybridization">
<meta property="og:description" content="The BMhyb package analyzes the phenotypic evolution of species
    of hybrid origin on a phylogenetic network. This package can detect a burst of variation at formation of a hybrid as well as a bias in typical hybrid values. Parameters are estimated by maximum likelihood, as well as returning regular Brownian motion parameters such as the rate of evolution and the root state.
    Users need to enter a comparative data set, a phylogeny, and information on gene
    flow leading to hybrids.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">BMhyb</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bomeara/BMhyb">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    

    
    
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="bmhyb" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#bmhyb" class="anchor"></a>BMhyb</h1></div>
<p><a href="https://travis-ci.org/bomeara/BMhyb"><img src="https://travis-ci.org/bomeara/BMhyb.svg" alt="Build Status"></a> <a href="https://codecov.io/gh/bomeara/BMhyb"><img src="https://codecov.io/gh/bomeara/BMhyb/branch/master/graph/badge.svg" alt="codecov"></a> <img class="badge" src="https://www.r-pkg.org/badges/version/BMhyb"><img class="badge" src="http://cranlogs.r-pkg.org/badges/grand-total/BMhyb"></p>
<p>While we often think of evolution as happening on a bifurcating evolutionary tree, in reality gene flow between distinct lineages is common. Until recently, there was little one could do about it. Our BMhyb package allows for fitting models of evolution to phylogenetic networks (also see <a href="https://doi.org/10.1093/sysbio/syy033">Bastide et al. 2018</a> for a similar approach, which is implemented in the Julia package <a href="https://github.com/crsl4/PhyloNetworks.jl">PhyloNetworks</a>). We have several models implemented that are restrictions of a general model. In the most general case, we assume Brownian motion of a trait on a phylogenetic network. Sometimes, lineages come together to form hybrids. We typically assume the hybrids receive equal input from both parents, but this can be altered. At the hybridization event, several things can happen: there could be increased variation (due to transgressive segregation, as in sunflowers) and/or there can be a shift in mean (as in ligers and tigons).</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install BMhyb from github with:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># install.packages("devtools")</span></a>
<a class="sourceLine" id="cb1-2" title="2">devtools<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/devtools/topics/reexports">install_github</a></span>(<span class="st">"bomeara/BMhyb"</span>)</a></code></pre></div>
<p>Input for the program is a phylogeny, trait data (currently just univariate), and a data.frame containing flow information. This tells the software where gene flow happened between lineages. This gene flow can appear to go forward in time due to flow to unsampled lineages before later hybridization, so one must specify both the time (height from root) of the start of the divergence of the hybridization event and the time at which the event completed (note, though, that it considers it as a single event, not ongoing gene flow through all this time). Here is a sample network for tobacco and relatives, after <a href="https://doi.org/10.1093/aob/mcg087">Chase et al. 2003</a>.</p>
<p><img src="nic_tree-1.png" width="700"></p>
<p>And here is one for cichlids, after <a href="https://bmcevolbiol.biomedcentral.com/articles/10.1186/1471-2148-7-7">Kobmuller et al. 2007</a></p>
<p><img src="cic_tree-1.png" width="700"></p>
<p>Besides the univariate trait data, another kind of data that can be useful is what is commonly called “measurement error.” This could mean actual measurement error: my ruler has markings every millimeter, so I have trouble figuring out if this beetle is 10.2 or 10.3 mm long. But it basically stands for all the variation that is present within a species. Brownian motion and related models are basically fitting data to a multivariate normal distribution. Covariances between species under basic models come from evolution on the same branches; variation of a tip value comes from both evolution along branches (Brownian motion “wiggling”) and other sources of variation that don’t stem from that evolutionary process: imprecision in the measurement, but also intraspecific variation (the processes model the “average” value for a species, but we know that intraspecific variation can be substantial and important) and other sources of noise. Most comparative methods are done assuming this uncertainty is zero: a single individual perfectly represents the mean value for its species. This forces the model to deal with any actual variation by forcing it to have happened on evolutionary branches, increasing the inferred rate of evolution (and also making the process look more like an Ornstein-Uhlenbeck one, assuming the true process is Brownian motion). By default, <code>BMhyb</code> instead tries to estimate this measurement error (the <code>SE</code> parameter, below) though this is hard to do well. Better is inputing actual uncertainty from estimates in the data: this could be done by measuring multiple individuals in some or all species or even approaches as crude as saying that one expects 10% uncertainty on each trait value.</p>
<p>Once you have your data, tree, and flow, you can run analyses using the <code><a href="reference/BMhyb.html">BMhyb()</a></code> function. The free parameters one can use are:</p>
<ul>
<li>
<code>sigma.sq</code> = sigma squared, the basic rate of Brownian motion of traits.</li>
<li>
<code>mu</code> = state at the root of the tree</li>
<li>
<code>SE</code> = standard error of the measurements (see the paragraph above)</li>
<li>
<code>bt</code> = beta, the expected change in state mean in hybridization events. Beta=1 means no expected change, beta=2 means an expected doubling in size, beta=0.5 means an expected halving in size, and so forth. Think of “hybrid vigor” and plant height</li>
<li>
<code>vh</code> = extra variance in trait value as a result of being formed through hybridization: an extra burst in variation</li>
</ul>
<p>Passing in a vector of the free parameters you want will have the program optimize those; otherwise, it will use default values.</p>
<p>Uncertainty is often substantial. Akaike weights are an estimate in the uncertainty in which model is best under the Akaike Information Criterion and are given by default. Parameter estimates are also uncertain. Fast ways to estimate the uncertainty involve looking at the curvature of the likelihood surface. Other approaches vary a single parameter at a time while holding the others at their maximum likelihood estimates and measuring the response. This can miss ridges: areas where one can vary one parameter at a time and quickly decline in value, but where one could vary both with little effect (for example, imagine looking at the plot of <code>x+y-10</code> and seeing where this was close to zero: if <code>y=5</code>, then x has to stay near 5 if we do not want the total to be far from 0, but if we allow both to vary, we can have an infinite array of values). To detect this, we vary all the points in an adaptive way to feel our way around an island of good likelihood to get estimates. Plots of this show points within a certain region (following Edwards, a ∆lnL of 2 is taken as the region) and points sampled outside.</p>
<p>Here is a sample run. It generates <code>BMhybResult</code> class object. Simply plotting this object calls a dedicated function.</p>
<pre><code>#&gt; [1] "Now starting analysis"
#&gt; [1] "Starting with initial values"
#&gt;      sigma.sq            mu            bt 
#&gt; 4.992629e-187  2.157905e+00  1.000000e+00 
#&gt;         step    negloglik     sigma.sq           mu           bt 
#&gt; 1.000000e+00 2.507867e+01 1.329036e-04 2.146213e+00 8.993696e-01 
#&gt; [1] "New improvement found, resetting step counter"
#&gt;         step    negloglik     sigma.sq           mu           bt 
#&gt;  2.000000000 24.787656185  0.000153596  2.100998006  0.733782545 
#&gt;         step    negloglik     sigma.sq           mu           bt 
#&gt;  3.000000000 24.787656185  0.000153596  2.100998006  0.733782545 
#&gt;         step    negloglik     sigma.sq           mu           bt 
#&gt;  4.000000000 24.787656185  0.000153596  2.100998006  0.733782545 
#&gt; [1] "New improvement found, resetting step counter"
#&gt;         step    negloglik     sigma.sq           mu           bt 
#&gt; 5.000000e+00 2.477650e+01 1.120235e-05 2.104338e+00 7.436673e-01 
#&gt;         step    negloglik     sigma.sq           mu           bt 
#&gt; 6.000000e+00 2.477650e+01 1.120235e-05 2.104338e+00 7.436673e-01 
#&gt;         step    negloglik     sigma.sq           mu           bt 
#&gt; 7.000000e+00 2.477650e+01 1.120235e-05 2.104338e+00 7.436673e-01 
#&gt;         step    negloglik     sigma.sq           mu           bt 
#&gt; 8.000000e+00 2.477650e+01 1.120235e-05 2.104338e+00 7.436673e-01 
#&gt;         step    negloglik     sigma.sq           mu           bt 
#&gt; 9.000000e+00 2.477650e+01 1.120235e-05 2.104338e+00 7.436673e-01 
#&gt;         step    negloglik     sigma.sq           mu           bt 
#&gt; 1.000000e+01 2.477650e+01 1.120235e-05 2.104338e+00 7.436673e-01 
#&gt;         step    negloglik     sigma.sq           mu           bt 
#&gt; 1.100000e+01 2.477650e+01 1.120235e-05 2.104338e+00 7.436673e-01 
#&gt;         step    negloglik     sigma.sq           mu           bt 
#&gt; 1.200000e+01 2.477650e+01 1.120235e-05 2.104338e+00 7.436673e-01 
#&gt;         step    negloglik     sigma.sq           mu           bt 
#&gt; 1.300000e+01 2.477650e+01 1.120235e-05 2.104338e+00 7.436673e-01 
#&gt;         step    negloglik     sigma.sq           mu           bt 
#&gt; 1.400000e+01 2.477650e+01 1.120235e-05 2.104338e+00 7.436673e-01 
#&gt;         step    negloglik     sigma.sq           mu           bt 
#&gt; 1.500000e+01 2.477650e+01 1.120235e-05 2.104338e+00 7.436673e-01 
#&gt; [1] "100 of 1000 done"
#&gt; [1] "200 of 1000 done"
#&gt; [1] "300 of 1000 done"
#&gt; [1] "400 of 1000 done"
#&gt; [1] "500 of 1000 done"
#&gt; [1] "600 of 1000 done"
#&gt; [1] "700 of 1000 done"
#&gt; [1] "800 of 1000 done"
#&gt; [1] "900 of 1000 done"
#&gt; [1] "1000 of 1000 done"</code></pre>
<p><img src="cichlid_run-1.png" width="700"></p>
<p>One common issue experienced in optimizing are problems with matrix condition – basically, internally the algorithm tries to invert a matrix, but for some combinations of networks and parameter values, numerically the matrix cannot be inverted (see <a href="https://en.wikipedia.org/wiki/Condition_number">Wikipedia</a> if you’re curious about the details. Note we accept pull requests to improve the code). There are approaches to dealing with this, but they often work by increasing the values on the diagonals of the variance covariance matrix – which biologically means artificially creating more “measurement error” in the model. We have various approaches to adjusting poorly conditioned matrices in <code>BMhyb</code>: most are turned off by default, and the one we do use we add a penalty to likelihood results that do use this. Make sure to look at your likelihoods to see if they seem reasonable, and in general poke around to make sure you believe the results the program gives you (this is good advice in general).</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=BMhyb">https://​cloud.r-project.org/​package=BMhyb</a>
</li>
<li>Browse source code at <br><a href="https://github.com/bomeara/BMhyb">https://​github.com/​bomeara/​BMhyb</a>
</li>
<li>Report a bug at <br><a href="https://github.com/bomeara/BMhyb/issues">https://​github.com/​bomeara/​BMhyb/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;=2)</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Dwueng-Chwuan Jhwueng <br><small class="roles"> Author, maintainer </small>  </li>
<li>Brian C. O'Meara <br><small class="roles"> Author </small>  </li>
</ul>
</div>

      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Dwueng-Chwuan Jhwueng, Brian C. O'Meara.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
